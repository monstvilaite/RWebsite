---
title: "Predict cryptos with ARMA GARCH and r-vine"
author: "Monika Monstvilaite"
date: 2017-07-23T21:13:14-05:00
categories: ["R"]
tags: ["R Markdown", "plot", "regression"]
---



<div id="analysis-based-on-data-available-at-2018-03-17-010000" class="section level1">
<h1>Analysis based on data available at 2018-03-17 01:00:00</h1>
<p>Note: data is random, anytrading strategies that</p>
</div>
<div id="marginal-log-returns" class="section level1">
<h1>Marginal Log-Returns</h1>
<p>Here is descriptive analysis of historical returns. See mean, median, min and max value for each cryptocurrency from 2017-08-29 02:00:00 to 2018-03-17 01:00:00:</p>
<p>The historical means of the data are the following:</p>
<pre><code>##    BCH    BTC    DCR    ETC    ETH    FCT    FTC    GNO    LTC    NEO 
##  0.003  0.003  0.002  0.000  0.002 -0.002  0.007 -0.004  0.004  0.003 
##    STR    VTC    WNG    XMR    XRP    ZEC 
## -0.002  0.005 -0.002  0.002  0.005 -0.001</code></pre>
<p>The historical variance of data is the following:</p>
<pre><code>##   BCH   BTC   DCR   ETC   ETH   FCT   FTC   GNO   LTC   NEO   STR   VTC 
## 0.100 0.060 0.085 0.093 0.062 0.100 0.121 0.110 0.086 0.101 0.113 0.114 
##   WNG   XMR   XRP   ZEC 
## 0.106 0.080 0.101 0.078</code></pre>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-6-1.png" width="336" /><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-6-2.png" width="336" /></p>
</div>
<div id="arma-garch-models-fitted" class="section level1">
<h1>ARMA-GARCH models fitted</h1>
<div id="standardized-error-distribution" class="section level2">
<h2>Standardized error distribution</h2>
<p>Should be mean 0, variance 1, no bumps, but cryptos are weird</p>
</div>
</div>
<div id="transforming-to-uniform-distribution" class="section level1">
<h1>Transforming to uniform distribution</h1>
<p>Nescessary in order to investigate dependence structure</p>
</div>
<div id="r-vine-copula" class="section level1">
<h1>R-Vine copula</h1>
<p>Instead of using correlation between variables, we will use r-vine copula. It is done so because correlation is not able to capture the nuances of assets that are correlated in for e.g. left tail of a distribution, but not a right tail. Intuition: cryptocurrencies might all crash at the same time, but when the market is doing well, they are uncorrelated.</p>
<p>Regular vine copula is a method to construct one solution for a simplified pair copula construction such that it would be as close as possible to real multivariate distribution that we aim to model. This way we are also able capture the dependency structure between the variables in an efficient way.</p>
<p>Kendall?s <span class="math inline">\(\tau\)</span> is given by: <span class="math inline">\(\tau = P((X_1-X_2)(Y_1-Y_2) &gt;0)-P((X_1-X_2)(Y_1-Y_2) &lt; 0)\)</span></p>
<p>where <span class="math inline">\((X_1, Y_1) \sim F\)</span> and <span class="math inline">\((X_2, Y_2) \sim F\)</span> are independent pairs of random variables. Kendall’s <span class="math inline">\(\tau\)</span> is a rank correlation. It does not depend directly on the values and thus is invariant under strictly monotone transformations (cite(Gruber)). On the contrary, linear correlation parameter Pearson’s <span class="math inline">\(\rho\)</span> is it not invariant under non-linear strictly increasing transformations, meaning that value of Pearson’s <span class="math inline">\(\rho\)</span> depends on marginal distributions. That is why Kendall?s <span class="math inline">\(\tau\)</span> is a more reliable measure in our case.</p>
<p>We plot here the dependence structure. Tree graph below shows the strongest dependencies between cryptocurrencies based on Kendall?s <span class="math inline">\(\tau\)</span>.</p>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Please note below how variables are encoded:</p>
<table>
<thead>
<tr class="header">
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BTC</td>
<td>DCR</td>
<td>ETC</td>
<td>ETH</td>
<td>FCT</td>
<td>FTC</td>
<td>GNO</td>
<td>GNT</td>
<td>LTC</td>
<td>STR</td>
<td>VTC</td>
<td>WNG</td>
<td>XMR</td>
<td>XRP</td>
<td>ZEC</td>
</tr>
</tbody>
</table>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-9-1.png" width="960" /></p>
<p>Copulas can help to perceive and visualize the nuances of dependence which is useful when describing the dependence of extreme events. In a figure above we can see that dependence structure can look very different and is not nescessarily symmetrical. Since copulas reveal dependence on a quantile scale, it is especially useful in the context of quantile based risk measures.</p>
</div>
<div id="prediction-one-day-ahead" class="section level1">
<h1>Prediction one day ahead</h1>
<div id="backtransforming" class="section level2">
<h2>Backtransforming</h2>
<p>Calculating variance from GARCH:</p>
<p><span class="math inline">\(\sigma_{t+1}^2 = \omega + \alpha_1 \epsilon_t^2 + \beta_1 \sigma_t^2\)</span></p>
<p>We use the above equation in order to find error distribution on <span class="math inline">\(T+2\)</span> that will be inserted to ARMA equation.</p>
<p><span class="math inline">\(\epsilon_{t+1} = \sigma_{t+1} z\)</span></p>
</div>
</div>
<div id="prediction-of-return-distribution-one-day-ahead" class="section level1">
<h1>Prediction of return distribution one day ahead</h1>
<p><span class="math inline">\(r_{t+1} = \mu + \epsilon_{t+1} + ar_1 r_t + ma_1 \epsilon_t\)</span></p>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre><code>##    DCR    ETC    ETH    FCT    FTC    GNO    LTC    STR    VTC    WNG 
## 0.0003 0.0080 0.0000 0.0127 0.0039 0.0106 0.0069 0.0096 0.0001 0.0160 
##    XMR    XRP    ZEC 
## 0.0127 0.0088 0.0047</code></pre>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
<pre><code>##            BTC rep.0..nsim..1 
##         -2e-04          0e+00</code></pre>
</div>
<div id="portfolio.-fat-left-tail" class="section level1">
<h1>Portfolio. FAT LEFT TAIL</h1>
<pre><code>##  [1] 0.003585041 0.084743627 0.000297610 0.134295833 0.041824679
##  [6] 0.112267693 0.072827869 0.101360710 0.000690420 0.170212773
## [11] 0.135175685 0.093399713 0.049318347</code></pre>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre><code>## [1] -0.1103163</code></pre>
<pre><code>## [1] 0.0147</code></pre>
<p>If investing in all assets equally, expected return is:</p>
<pre><code>##   Portfolio 
## 0.006720391</code></pre>
</div>
<div id="monikas-section" class="section level1">
<h1>Monika’s section</h1>
<p>This section is to exaluate how the ARMA-GARCH fitted the marginal time series.</p>
<p>What we pay attention: how arma garch was able to determine Value at Risk: If the red curve is able to determine and adjust to the shocks, model is working well. If the red curve resembles a line (or not too far from it), that means the data is too random. We still include those variables, since they are dependent to other variables in the model.</p>
<div id="btc.-var-qq-plot-acf" class="section level2">
<h2>BTC. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre><code>##           Estimate   Std. Error   t value     Pr(&gt;|t|)
## omega  0.000323806 0.0005201745 0.6224949 5.336165e-01
## alpha1 0.090789055 0.0827590869 1.0970282 2.726291e-01
## beta1  0.828417127 0.2039239566 4.0623826 4.857438e-05
## shape  6.567929058 3.6138718827 1.8174217 6.915257e-02</code></pre>
</div>
<div id="dcr.-var-qq-plot-acf" class="section level2">
<h2>DCR. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre><code>##            Estimate   Std. Error      t value   Pr(&gt;|t|)
## omega  1.381755e-05 1.599807e-05 8.637010e-01 0.38775215
## alpha1 2.738276e-09 5.022444e-03 5.452079e-07 0.99999956
## beta1  9.990000e-01 1.656282e-03 6.031583e+02 0.00000000
## shape  7.588393e+00 3.407986e+00 2.226650e+00 0.02597065</code></pre>
</div>
<div id="etc.-var-qq-plot-acf" class="section level2">
<h2>ETC. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error    t value     Pr(&gt;|t|)
## ma1    -0.1153396585 0.0654078627 -1.7633913 7.783451e-02
## omega   0.0001483119 0.0002134056  0.6949764 4.870701e-01
## alpha1  0.0981487493 0.0464483946  2.1130709 3.459470e-02
## beta1   0.9008512487 0.0446596067 20.1714998 0.000000e+00
## shape   3.0389827385 0.5505538631  5.5198645 3.392611e-08</code></pre>
</div>
<div id="eth.-var-qq-plot-acf" class="section level2">
<h2>ETH. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre><code>##            Estimate   Std. Error  t value     Pr(&gt;|t|)
## omega  0.0003190764 0.0002486942 1.283007 1.994896e-01
## alpha1 0.2152843425 0.1163473846 1.850358 6.426193e-02
## beta1  0.7395724273 0.1177232958 6.282295 3.336118e-10
## shape  4.5774455456 1.7716709463 2.583688 9.775008e-03</code></pre>
</div>
<div id="factom-fct.-var-qq-plot-acf" class="section level2">
<h2>Factom (FCT). VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error    t value    Pr(&gt;|t|)
## ma1    -0.1690176874 0.0726629815 -2.3260494 0.020015913
## omega   0.0005564677 0.0005981634  0.9302938 0.352219010
## alpha1  0.1286185151 0.0765700978  1.6797486 0.093006238
## beta1   0.8293968817 0.0958207020  8.6557170 0.000000000
## shape   4.8849733277 1.7680419984  2.7629283 0.005728534</code></pre>
</div>
<div id="feathercoin-ftc.-var-qq-plot-acf" class="section level2">
<h2>FeatherCoin (FTC). VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre><code>##            Estimate  Std. Error   t value     Pr(&gt;|t|)
## ar1     0.658804095 0.232601555  2.832329 0.0046210297
## ma1    -0.728552483 0.205012309 -3.553701 0.0003798506
## omega   0.004651116 0.003132946  1.484582 0.1376545609
## alpha1  0.111652342 0.080243583  1.391418 0.1640987971
## beta1   0.595348147 0.222984732  2.669905 0.0075872612
## shape   3.935170785 1.135428427  3.465803 0.0005286513</code></pre>
</div>
<div id="gno.-var-qq-plot-acf" class="section level2">
<h2>GNO. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error    t value     Pr(&gt;|t|)
## ar1     0.3372635821 0.2479486848  1.3602152 0.1737618183
## ma1    -0.4643295743 0.2295842119 -2.0224804 0.0431267440
## omega   0.0002608916 0.0003403091  0.7666313 0.4433007372
## alpha1  0.0324447364 0.0247767847  1.3094813 0.1903713665
## beta1   0.9515250052 0.0311926911 30.5047423 0.0000000000
## shape   3.5552283477 0.9260062327  3.8393136 0.0001233787</code></pre>
</div>
<div id="gnt.-var-qq-plot-acf" class="section level2">
<h2>GNT. VaR, QQ-plot, ACF</h2>
</div>
<div id="ltc.-var-qq-plot-acf" class="section level2">
<h2>LTC. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<pre><code>##            Estimate   Std. Error   t value     Pr(&gt;|t|)
## ma1    -0.120968297 0.0692789784 -1.746104 8.079289e-02
## omega   0.000692038 0.0005392184  1.283409 1.993487e-01
## alpha1  0.161539967 0.1082618801  1.492122 1.356671e-01
## beta1   0.773553568 0.0987181660  7.835980 4.662937e-15
## shape   3.097403899 0.6847085167  4.523682 6.077288e-06</code></pre>
</div>
<div id="str.-var-qq-plot-acf" class="section level2">
<h2>STR. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre><code>##             Estimate  Std. Error       t value   Pr(&gt;|t|)
## ma1    -1.068069e-01 0.063744094 -1.675557e+00 0.09382501
## omega   8.922667e-03 0.005953094  1.498828e+00 0.13391814
## alpha1  2.794897e-01 0.119926653  2.330506e+00 0.01977944
## beta1   2.023537e-15 0.651564030  3.105661e-15 1.00000000
## shape   1.151540e+01 7.254075467  1.587438e+00 0.11241340</code></pre>
</div>
<div id="vtc.-var-qq-plot-acf" class="section level2">
<h2>VTC. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre><code>##            Estimate   Std. Error      t value   Pr(&gt;|t|)
## omega  6.378141e-11 4.785813e-05 1.332718e-06 0.99999894
## alpha1 1.190471e-02 9.894923e-03 1.203113e+00 0.22893252
## beta1  9.849492e-01 9.492471e-03 1.037611e+02 0.00000000
## shape  9.062873e+00 4.991807e+00 1.815550e+00 0.06943947</code></pre>
</div>
<div id="wng.-var-qq-plot-acf" class="section level2">
<h2>WNG. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error    t value    Pr(&gt;|t|)
## ma1    -0.1700754280 0.0861989038 -1.9730579 0.048488966
## omega   0.0001543374 0.0002015482  0.7657591 0.443819627
## alpha1  0.0419935018 0.0239588761  1.7527325 0.079647927
## beta1   0.9469964539 0.0313405280 30.2163528 0.000000000
## shape   4.4382177064 1.3958130176  3.1796649 0.001474454</code></pre>
</div>
<div id="xmr.-var-qq-plot-acf" class="section level2">
<h2>XMR. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error    t value     Pr(&gt;|t|)
## ma1    -0.1594760915 0.0646394709 -2.4671627 1.361885e-02
## omega   0.0001367293 0.0002157099  0.6338574 5.261739e-01
## alpha1  0.1115035265 0.0603622097  1.8472406 6.471227e-02
## beta1   0.8874964690 0.0673031621 13.1865494 0.000000e+00
## shape   3.5381163090 0.8487312581  4.1687122 3.063256e-05</code></pre>
</div>
<div id="xrp.-var-qq-plot-acf" class="section level2">
<h2>XRP. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error   t value     Pr(&gt;|t|)
## ma1    -0.1431532802 0.0589053527 -2.430225 1.508944e-02
## omega   0.0001436813 0.0001315022  1.092615 2.745629e-01
## alpha1  0.0532801830 0.0329152300  1.618709 1.055099e-01
## beta1   0.9457197992 0.0307159822 30.789177 0.000000e+00
## shape   2.6388594875 0.4579320993  5.762556 8.284941e-09</code></pre>
</div>
<div id="zec.-var-qq-plot-acf" class="section level2">
<h2>ZEC. VaR, QQ-plot, ACF</h2>
<p><img src="/post/2018-01-30-crypto-dependencies_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<pre><code>##             Estimate   Std. Error   t value  Pr(&gt;|t|)
## ma1    -0.0863841484 0.0736144593 -1.173467 0.2406085
## omega   0.0003351623 0.0003125721  1.072272 0.2835979
## alpha1  0.0905998450 0.0632392456  1.432652 0.1519573
## beta1   0.8565193657 0.0857241941  9.991571 0.0000000
## shape   6.0139040407 2.7354736021  2.198487 0.0279144</code></pre>
</div>
</div>
